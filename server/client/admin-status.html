<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Admin Status - KingChat</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white;
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 20px; 
            backdrop-filter: blur(10px);
        }
        .status-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .status-card { 
            background: rgba(255,255,255,0.2); 
            padding: 20px; 
            border-radius: 15px; 
            text-align: center;
            transition: all 0.3s ease;
        }
        .status-card:hover { 
            background: rgba(255,255,255,0.3); 
            transform: translateY(-5px);
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
        .info { border-left: 4px solid #17a2b8; }
        
        button { 
            padding: 12px 24px; 
            margin: 10px; 
            background: rgba(255,255,255,0.2); 
            color: white; 
            border: 2px solid white; 
            border-radius: 25px; 
            cursor: pointer; 
            font-weight: 500;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: white; 
            color: #667eea; 
            transform: scale(1.05);
        }
        
        .admin-card { 
            background: rgba(255,255,255,0.15); 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .icon { font-size: 2em; margin-bottom: 10px; }
        .count { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .loading { animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .timestamp { 
            font-size: 0.9em; 
            opacity: 0.8; 
            margin-top: 10px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 30px;">
            üìä KingChat Admin System Status
        </h1>
        
        <div class="status-grid">
            <div class="status-card info" id="apiStatus">
                <div class="icon">üì°</div>
                <h3>API Status</h3>
                <div id="apiStatusText" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                <div class="timestamp" id="apiTimestamp"></div>
            </div>
            
            <div class="status-card success" id="adminCount">
                <div class="icon">üë•</div>
                <h3>Admin Count</h3>
                <div class="count" id="adminCountNumber">-</div>
                <div class="timestamp" id="countTimestamp"></div>
            </div>
            
            <div class="status-card warning" id="dbStatus">
                <div class="icon">üóÉÔ∏è</div>
                <h3>Database</h3>
                <div id="dbStatusText" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                <div class="timestamp" id="dbTimestamp"></div>
            </div>
            
            <div class="status-card info" id="serverStatus">
                <div class="icon">üöÄ</div>
                <h3>Server Status</h3>
                <div id="serverStatusText" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                <div class="timestamp" id="serverTimestamp"></div>
            </div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="refreshAllStatus()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            <button onclick="openAdminPage()">üìã ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
            <button onclick="testAPI()">üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</button>
        </div>
        
        <div id="adminList" style="margin-top: 30px;">
            <h3 style="text-align: center; margin-bottom: 20px;">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
            <div id="adminCards"></div>
        </div>
        
        <div id="logs" style="margin-top: 30px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px;">
            <h4>üìù System Logs</h4>
            <div id="logContent" style="font-family: monospace; font-size: 0.9em; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://kingchat.up.railway.app/api/admin';
        let logCount = 0;
        
        function addLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #ccc;">${time}</span> - ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            // Keep only last 20 logs
            if (logContent.children.length > 20) {
                logContent.removeChild(logContent.firstChild);
            }
        }
        
        async function checkAPIStatus() {
            const apiCard = document.getElementById('apiStatus');
            const statusText = document.getElementById('apiStatusText');
            const timestamp = document.getElementById('apiTimestamp');
            
            try {
                const startTime = Date.now();
                const response = await fetch(API_URL);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    statusText.innerHTML = `‚úÖ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå<br><small>Response: ${responseTime}ms</small>`;
                    apiCard.className = 'status-card success';
                    addLog('‚úÖ API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥');
                } else {
                    statusText.innerHTML = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î<br><small>Status: ${response.status}</small>`;
                    apiCard.className = 'status-card error';
                    addLog(`‚ùå API Error: ${response.status}`);
                }
                
                timestamp.textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
                
            } catch (error) {
                statusText.innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠<br><small>${error.message}</small>`;
                apiCard.className = 'status-card error';
                timestamp.textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
                addLog(`‚ùå API Connection Failed: ${error.message}`);
            }
        }
        
        async function loadAdminData() {
            try {
                addLog('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...');
                const response = await fetch(API_URL);
                
                if (response.ok) {
                    const admins = await response.json();
                    
                    // Update count
                    document.getElementById('adminCountNumber').textContent = admins.length;
                    document.getElementById('countTimestamp').textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
                    
                    // Display admin cards
                    displayAdmins(admins);
                    
                    addLog(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ${admins.length} ‡∏Ñ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                    
                    // Update database status
                    document.getElementById('dbStatusText').innerHTML = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('dbStatus').className = 'status-card success';
                    document.getElementById('dbTimestamp').textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
                    
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                document.getElementById('adminCountNumber').textContent = '?';
                document.getElementById('dbStatusText').innerHTML = '‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                document.getElementById('dbStatus').className = 'status-card error';
                addLog(`‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
            }
        }
        
        function displayAdmins(admins) {
            const adminCards = document.getElementById('adminCards');
            adminCards.innerHTML = '';
            
            if (admins.length === 0) {
                adminCards.innerHTML = '<div style="text-align: center; padding: 20px; opacity: 0.7;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>';
                return;
            }
            
            admins.forEach((admin, index) => {
                const card = document.createElement('div');
                card.className = 'admin-card';
                card.style.animationDelay = `${index * 0.1}s`;
                
                const roleIcon = admin.role === 'super_admin' ? 'üëë' : 'üë®‚Äçüíº';
                const roleText = admin.role === 'super_admin' ? 'Super Admin' : 'Admin';
                
                card.innerHTML = `
                    <div>
                        <strong>${roleIcon} ${admin.fullName}</strong><br>
                        <small>@${admin.username} ‚Ä¢ ${roleText}</small>
                    </div>
                    <div style="text-align: right;">
                        <div>üèÜ ${admin.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <small>üì® ${admin.messagesHandled} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</small>
                    </div>
                `;
                
                adminCards.appendChild(card);
            });
        }
        
        async function checkServerStatus() {
            const serverText = document.getElementById('serverStatusText');
            const serverCard = document.getElementById('serverStatus');
            const timestamp = document.getElementById('serverTimestamp');
            
            try {
                const response = await fetch('https://kingchat.up.railway.app/');
                if (response.ok) {
                    serverText.innerHTML = '‚úÖ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                    serverCard.className = 'status-card success';
                    addLog('‚úÖ Server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥');
                } else {
                    serverText.innerHTML = '‚ö†Ô∏è ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤';
                    serverCard.className = 'status-card warning';
                }
                timestamp.textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                serverText.innerHTML = '‚ùå ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                serverCard.className = 'status-card error';
                timestamp.textContent = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${new Date().toLocaleTimeString()}`;
                addLog(`‚ùå Server ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á: ${error.message}`);
            }
        }
        
        async function refreshAllStatus() {
            addLog('üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...');
            
            // Reset loading states
            document.querySelectorAll('.loading').forEach(el => {
                el.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
                el.className = 'loading';
            });
            
            // Run all checks
            await Promise.all([
                checkAPIStatus(),
                loadAdminData(),
                checkServerStatus()
            ]);
            
            addLog('‚úÖ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
        }
        
        function openAdminPage() {
            window.open('https://kingchat.up.railway.app/admin-working.html', '_blank');
        }
        
        function testAPI() {
            window.open('https://kingchat.up.railway.app/admin-debug.html', '_blank');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ System Status Page ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à');
            refreshAllStatus();
            
            // Auto refresh every 30 seconds
            setInterval(refreshAllStatus, 30000);
        });
    </script>
</body>
</html>