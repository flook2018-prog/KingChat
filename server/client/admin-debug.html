<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Admin Debug - KingChat</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .debug-panel { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; overflow-x: auto; }
        .admin-card { border: 1px solid #ddd; padding: 15px; margin: 10px; border-radius: 8px; background: #fff; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Admin System Debug Panel</h1>
        <p>à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¹à¸à¹‰à¹„à¸‚à¸›à¸±à¸à¸«à¸²à¸£à¸°à¸šà¸šà¹à¸­à¸”à¸¡à¸´à¸™</p>
        
        <div class="grid">
            <div>
                <h3>ğŸš€ à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š</h3>
                <button onclick="testAPI()">ğŸ“¡ à¸—à¸”à¸ªà¸­à¸š API</button>
                <button onclick="testLocalStorage()" class="btn-warning">ğŸ’¾ à¸—à¸”à¸ªà¸­à¸š LocalStorage</button>
                <button onclick="testCORS()" class="btn-success">ğŸŒ à¸—à¸”à¸ªà¸­à¸š CORS</button>
                <button onclick="simulateAdminLoad()" class="btn-success">ğŸ‘¥ à¸ˆà¸³à¸¥à¸­à¸‡à¹‚à¸«à¸¥à¸”à¹à¸­à¸”à¸¡à¸´à¸™</button>
                <button onclick="clearAll()" class="btn-danger">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
            </div>
            
            <div>
                <h3>ğŸ”— à¸¥à¸´à¸‡à¸à¹Œà¸”à¹ˆà¸§à¸™</h3>
                <button onclick="openAdminPage()">ğŸ“‹ à¹€à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¹à¸­à¸”à¸¡à¸´à¸™</button>
                <button onclick="openAPITest()">ğŸ§ª à¹€à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸—à¸”à¸ªà¸­à¸š API</button>
                <button onclick="openConsole()" class="btn-warning">ğŸ” à¹€à¸›à¸´à¸” Console</button>
                <button onclick="location.reload()" class="btn-warning">ğŸ”„ Reload à¸«à¸™à¹‰à¸²</button>
            </div>
        </div>
        
        <div id="results"></div>
        
        <div id="adminDisplay" style="margin-top: 20px;"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://kingchat.up.railway.app/api';
        
        function addResult(message, type = 'debug-panel') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        function clearAll() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('adminDisplay').innerHTML = '';
        }
        
        async function testAPI() {
            addResult('ğŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸ªà¸­à¸š API...');
            
            try {
                // Test 1: Basic connectivity
                const response = await fetch(`${API_BASE_URL}/admin`);
                addResult(`ğŸ“¡ Response Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`âœ… API Success! Admin count: ${data.length}`, 'success');
                    
                    // Display the data
                    displayAdmins(data);
                    
                    // Test individual admin properties
                    if (data.length > 0) {
                        const firstAdmin = data[0];
                        addResult(`ğŸ‘¤ First Admin Properties:`, 'debug-panel');
                        addResult(`<div class="code">${JSON.stringify(firstAdmin, null, 2)}</div>`, 'debug-panel');
                    }
                    
                } else {
                    const errorText = await response.text();
                    addResult(`âŒ API Error: ${errorText}`, 'error');
                }
                
            } catch (error) {
                addResult(`âŒ Network Error: ${error.message}`, 'error');
            }
        }
        
        function testLocalStorage() {
            addResult('ğŸ’¾ à¸—à¸”à¸ªà¸­à¸š LocalStorage...');
            
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                addResult(`âœ… LocalStorage works: ${value}`, 'success');
                
                // Check existing data
                const keys = Object.keys(localStorage);
                addResult(`ğŸ“Š LocalStorage Keys: ${keys.join(', ')}`, 'debug-panel');
                
            } catch (error) {
                addResult(`âŒ LocalStorage Error: ${error.message}`, 'error');
            }
        }
        
        async function testCORS() {
            addResult('ğŸŒ à¸—à¸”à¸ªà¸­à¸š CORS...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin`, {
                    method: 'OPTIONS'
                });
                
                addResult(`ğŸ“¡ CORS Response: ${response.status}`, 'debug-panel');
                addResult(`ğŸ”’ Access-Control-Allow-Origin: ${response.headers.get('access-control-allow-origin')}`, 'debug-panel');
                addResult(`ğŸ”’ Access-Control-Allow-Methods: ${response.headers.get('access-control-allow-methods')}`, 'debug-panel');
                
                if (response.ok) {
                    addResult('âœ… CORS configured correctly', 'success');
                } else {
                    addResult('âš ï¸ CORS may have issues', 'warning');
                }
                
            } catch (error) {
                addResult(`âŒ CORS Error: ${error.message}`, 'error');
            }
        }
        
        function simulateAdminLoad() {
            addResult('ğŸ‘¥ à¸ˆà¸³à¸¥à¸­à¸‡à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¹à¸­à¸”à¸¡à¸´à¸™...');
            
            const mockAdmins = [
                {
                    id: 1,
                    fullName: 'Test Administrator',
                    username: 'testadmin',
                    role: 'super_admin',
                    points: 5000,
                    messagesHandled: 250
                },
                {
                    id: 2,
                    fullName: 'Support Agent',
                    username: 'support',
                    role: 'admin',
                    points: 3000,
                    messagesHandled: 150
                }
            ];
            
            addResult(`âœ… Mock data created: ${mockAdmins.length} admins`, 'success');
            displayAdmins(mockAdmins);
        }
        
        function displayAdmins(adminList) {
            const displayDiv = document.getElementById('adminDisplay');
            
            if (!adminList || adminList.length === 0) {
                displayDiv.innerHTML = '<div class="error">à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸­à¸”à¸¡à¸´à¸™</div>';
                return;
            }
            
            let html = `<h3>ğŸ‘¥ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸­à¸”à¸¡à¸´à¸™ (${adminList.length} à¸„à¸™)</h3>`;
            
            adminList.forEach(admin => {
                html += `
                    <div class="admin-card">
                        <h4>ğŸ‘¤ ${admin.fullName} (@${admin.username})</h4>
                        <p><strong>Role:</strong> ${admin.role}</p>
                        <p><strong>Points:</strong> ${admin.points || 0}</p>
                        <p><strong>Messages:</strong> ${admin.messagesHandled || 0}</p>
                        <p><strong>ID:</strong> ${admin.id}</p>
                    </div>
                `;
            });
            
            displayDiv.innerHTML = html;
            addResult(`âœ… à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸­à¸”à¸¡à¸´à¸™ ${adminList.length} à¸„à¸™`, 'success');
        }
        
        function openAdminPage() {
            window.open('https://kingchat.up.railway.app/admin-working.html', '_blank');
        }
        
        function openAPITest() {
            window.open('https://kingchat.up.railway.app/admin-api-test.html', '_blank');
        }
        
        function openConsole() {
            addResult('ğŸ” à¸à¸” F12 à¹€à¸à¸·à¹ˆà¸­à¹€à¸›à¸´à¸” Developer Console', 'warning');
            console.log('ğŸ”§ KingChat Debug Console Ready');
            console.log('ğŸ“¡ API Base URL:', API_BASE_URL);
            console.log('ğŸŒ Current URL:', window.location.href);
        }
        
        // Auto-run basic test on load
        window.onload = function() {
            addResult('ğŸ“„ Debug panel loaded successfully', 'success');
            addResult(`ğŸ”— API URL: ${API_BASE_URL}`, 'debug-panel');
            addResult('ğŸ’¡ à¹€à¸¥à¸·à¸­à¸à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸ˆà¸²à¸à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸šà¸™', 'debug-panel');
        };
    </script>
</body>
</html>