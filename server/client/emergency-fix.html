<!DOCTYPE html>
<html>
<head>
    <title>üöë Emergency Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .fix-box { background: #fff3cd; border: 1px solid #ffc107; padding: 20px; margin: 10px 0; border-radius: 5px; }
        button { background: #dc3545; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; }
        .success { background: #d4edda; border-color: #28a745; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 3px solid #007bff; }
    </style>
</head>
<body>
    <h1>üöë Emergency Admin Fix</h1>
    
    <div class="fix-box">
        <h3>‚ö° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πà‡∏ß‡∏ô - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
        <p>‡∏´‡∏≤‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà work ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô</p>
        
        <button onclick="createWorkingAdmin()">üîß ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô working123</button>
        <button onclick="resetDefaultAdmin()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï admin ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
        <button onclick="fixExistingUser()">üõ†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç aaa ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</button>
        
        <div id="result" class="result"></div>
    </div>

    <div class="fix-box">
        <h3>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</h3>
        <input type="text" id="test-user" placeholder="Username" value="working123" style="padding: 10px; margin: 5px;">
        <input type="password" id="test-pass" placeholder="Password" value="working123" style="padding: 10px; margin: 5px;">
        <button onclick="testLogin()" style="background: #28a745;">üîë ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</button>
        
        <div id="login-result" class="result"></div>
    </div>

    <div class="fix-box">
        <h3>üìù ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
        <div style="background: white; padding: 10px; border-radius: 3px;">
            <strong>Default Admin:</strong> admin / admin123<br>
            <strong>Working Admin:</strong> working123 / working123<br>
            <strong>Fixed User:</strong> aaa / aaa123
        </div>
    </div>

    <script>
        async function createWorkingAdmin() {
            try {
                const result = document.getElementById('result');
                result.innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô working123...';
                
                const response = await fetch('/api/admin/admin-users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'working123',
                        displayName: 'Working Test Admin',
                        password: 'working123',
                        role: 'admin'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `
                        ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                        <strong>Username:</strong> working123<br>
                        <strong>Password:</strong> working123<br>
                        <br>‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ login ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
                    `;
                    result.className = 'result success';
                } else {
                    result.innerHTML = `‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function resetDefaultAdmin() {
            try {
                const result = document.getElementById('result');
                result.innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï admin ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...';
                
                const response = await fetch('/api/admin/fix-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        newPassword: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `
                        ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                        <strong>Username:</strong> admin<br>
                        <strong>Password:</strong> admin123
                    `;
                    result.className = 'result success';
                } else {
                    result.innerHTML = `‚ùå ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function fixExistingUser() {
            try {
                const result = document.getElementById('result');
                result.innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ aaa...';
                
                const response = await fetch('/api/admin/fix-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'aaa',
                        newPassword: 'aaa123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `
                        ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                        <strong>Username:</strong> aaa<br>
                        <strong>Password:</strong> aaa123
                    `;
                    result.className = 'result success';
                    
                    // Update test form
                    document.getElementById('test-user').value = 'aaa';
                    document.getElementById('test-pass').value = 'aaa123';
                } else {
                    result.innerHTML = `‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function testLogin() {
            const username = document.getElementById('test-user').value;
            const password = document.getElementById('test-pass').value;
            
            try {
                const result = document.getElementById('login-result');
                result.innerHTML = `üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö ${username}...`;
                
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `
                        üéâ <strong>LOGIN ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong><br>
                        Username: ${data.user.username}<br>
                        Display Name: ${data.user.displayName}<br>
                        Role: ${data.user.role}<br>
                        <br>
                        <button onclick="window.open('/login.html', '_blank')" style="background: #28a745; color: white; padding: 10px; border: none; border-radius: 3px;">
                            ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏à‡∏£‡∏¥‡∏á
                        </button>
                    `;
                    result.className = 'result success';
                } else {
                    result.innerHTML = `‚ùå Login ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${data.error}`;
                    result.className = 'result';
                }
                
            } catch (error) {
                document.getElementById('login-result').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>