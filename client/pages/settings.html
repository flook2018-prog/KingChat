<!DOCTY    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/loading.css">
    <link rel="stylesheet" href="../css/mobile.css">
    <link rel="stylesheet" href="../css/line-theme.css">
    <link rel="stylesheet" href="../css/brand-animation.css">
    <link rel="stylesheet" href="../css/responsive-ux.css">
    <style>
        /* ‡∏¢‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î navbar */
        .main-content {
            padding-top: var(--space-4) !important;
            max-height: calc(100vh - var(--navbar-height)) !important;
            overflow-y: auto !important;
            display: flex !important;
            flex-direction: column !important;
        }
        
        .page-header {
            margin-top: 0 !important;
            padding-top: 0 !important;
            margin-bottom: var(--space-4) !important;
            flex-shrink: 0 !important;
        }
        
        .page-content {
            flex: 1 !important;
            overflow-y: auto !important;
            padding-bottom: var(--space-4) !important;
        }
        
        .settings-tabs-content {
            max-height: calc(100vh - 250px) !important;
            overflow-y: auto !important;
        }
    </style>tml>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö - KingChat</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/loading.css">
    <link rel="stylesheet" href="../css/mobile.css">
    <link rel="stylesheet" href="../css/line-theme.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <span class="crown">üëë</span>
            <span class="brand-text">KingChat</span>
        </div>
        <div class="navbar-menu">
            <div class="navbar-item">
                <button class="theme-toggle" id="themeToggle" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏µ">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
            <div class="navbar-item">
                <span>System Administrator</span>
            </div>
            <div class="dropdown navbar-item">
                <button class="btn btn-ghost dropdown-toggle" id="userMenu">
                    üë§
                </button>
                <div class="dropdown-menu" id="userDropdown">
                    <a href="#" class="dropdown-item">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                    <a href="#" class="dropdown-item">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-menu">
            <a href="../dashboard.html" class="menu-item">
                <span class="menu-icon">üè†</span>
                <span class="menu-text">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </a>
            <a href="lineoa.html" class="menu-item">
                <span class="menu-icon">üì±</span>
                <span class="menu-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ LINE OA</span>
            </a>
            <a href="customers.html" class="menu-item">
                <span class="menu-icon">üë•</span>
                <span class="menu-text">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
            </a>
            <a href="chat.html" class="menu-item">
                <span class="menu-icon">üí¨</span>
                <span class="menu-text">‡πÅ‡∏ä‡∏ó</span>
            </a>
            <a href="admin-management.html" class="menu-item">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span class="menu-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
            </a>
            <a href="settings.html" class="menu-item active">
                <span class="menu-icon">üîß</span>
                <span class="menu-text">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h1>
            <p class="page-subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö KingChat</p>
        </div>

        <!-- Settings Sections -->
        <div class="content-grid">
            <!-- General Settings -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                </div>
                <div class="card-content">
                    <form id="generalSettingsForm">
                        <div class="form-group">
                            <label for="systemName">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö</label>
                            <input type="text" id="systemName" class="form-control" value="KingChat">
                        </div>
                        
                        <div class="form-group">
                            <label for="systemDescription">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö</label>
                            <textarea id="systemDescription" class="form-control" rows="3">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ LINE Official Account</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="timezone">‡πÄ‡∏Ç‡∏ï‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <select id="timezone" class="form-control">
                                <option value="Asia/Bangkok" selected>Asia/Bangkok (GMT+7)</option>
                                <option value="UTC">UTC (GMT+0)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="language">‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <select id="language" class="form-control">
                                <option value="th" selected>‡πÑ‡∏ó‡∏¢</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    </form>
                </div>
            </div>

            <!-- Notification Settings -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                </div>
                <div class="card-content">
                    <form id="notificationSettingsForm">
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="emailNotifications" class="form-check-input" checked>
                                <label for="emailNotifications" class="form-check-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="pushNotifications" class="form-check-input" checked>
                                <label for="pushNotifications" class="form-check-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Push</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="smsNotifications" class="form-check-input">
                                <label for="smsNotifications" class="form-check-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á SMS</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="notificationFrequency">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                            <select id="notificationFrequency" class="form-control">
                                <option value="immediate" selected>‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
                                <option value="hourly">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                                <option value="weekly">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    </form>
                </div>
            </div>

            <!-- LINE Settings -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">üì± ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE</h3>
                </div>
                <div class="card-content">
                    <form id="lineSettingsForm">
                        <div class="form-group">
                            <label for="defaultReplyMessage">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</label>
                            <textarea id="defaultReplyMessage" class="form-control" rows="3">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö</textarea>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="autoReply" class="form-check-input" checked>
                                <label for="autoReply" class="form-check-label">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="richmenu" class="form-check-input">
                                <label for="richmenu" class="form-check-label">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ Rich Menu</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="businessHours">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</label>
                            <div style="display: flex; gap: var(--space-3); align-items: center;">
                                <input type="time" id="startTime" class="form-control" value="09:00">
                                <span>‡∏ñ‡∏∂‡∏á</span>
                                <input type="time" id="endTime" class="form-control" value="18:00">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    </form>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">üîí ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h3>
                </div>
                <div class="card-content">
                    <form id="securitySettingsForm">
                        <div class="form-group">
                            <label for="sessionTimeout">‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                            <input type="number" id="sessionTimeout" class="form-control" value="60" min="15" max="480">
                        </div>
                        
                        <div class="form-group">
                            <label for="maxLoginAttempts">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                            <input type="number" id="maxLoginAttempts" class="form-control" value="5" min="3" max="10">
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="twoFactorAuth" class="form-check-input">
                                <label for="twoFactorAuth" class="form-check-label">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏ö‡∏ö 2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" id="ipWhitelist" class="form-check-input">
                                <label for="ipWhitelist" class="form-check-label">‡∏à‡∏≥‡∏Å‡∏±‡∏î IP ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    </form>
                </div>
            </div>

            <!-- Database Settings -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">üóÑÔ∏è ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                </div>
                <div class="card-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üíæ</div>
                            <div class="stat-content">
                                <div class="stat-number">1.2 GB</div>
                                <div class="stat-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-content">
                                <div class="stat-number">15,247</div>
                                <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: var(--space-4); display: flex; gap: var(--space-3);">
                        <button class="btn btn-primary" id="backupBtn">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button class="btn btn-ghost" id="optimizeBtn">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                </div>
            </div>

            <!-- Quick Messages -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">‚ö° ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô</h3>
                    <button class="btn btn-primary btn-sm" id="addQuickMessageBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                </div>
                <div class="card-content">
                    <div id="quickMessagesList">
                        <div class="quick-message-item">
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ</div>
                                <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö</div>
                            </div>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-ghost btn-sm">‚úèÔ∏è</button>
                                <button class="btn btn-ghost btn-sm">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="quick-message-item">
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì</div>
                                <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö</div>
                            </div>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-ghost btn-sm">‚úèÔ∏è</button>
                                <button class="btn btn-ghost btn-sm">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/auth.js"></script>
    <script src="../js/api.js"></script>
    <script>
        // Check authentication - wait for auth to be ready
        function checkAuth() {
            if (window.auth && window.auth.getToken && !window.auth.getToken()) {
                window.location.href = '../login.html';
            } else if (!window.auth) {
                setTimeout(checkAuth, 100);
            }
        }
        checkAuth();

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (window.auth && window.auth.logout) {
                window.auth.logout();
            }
            window.location.href = '../login.html';
        });

        // User menu dropdown
        document.getElementById('userMenu').addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const userMenu = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            if (userMenu && dropdown && !userMenu.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', loadSettings);

        async function loadSettings() {
            try {
                const settings = await api.get('/settings');
                populateSettingsForm(settings);
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function populateSettingsForm(settings) {
            // General settings
            if (settings.general) {
                document.getElementById('systemName').value = settings.general.systemName || 'KingChat';
                document.getElementById('systemDescription').value = settings.general.systemDescription || '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ LINE Official Account';
                document.getElementById('timezone').value = settings.general.timezone || 'Asia/Bangkok';
                document.getElementById('language').value = settings.general.language || 'th';
            }

            // Notification settings
            if (settings.notifications) {
                document.getElementById('emailNotifications').checked = settings.notifications.email !== false;
                document.getElementById('pushNotifications').checked = settings.notifications.push !== false;
                document.getElementById('smsNotifications').checked = settings.notifications.sms === true;
                document.getElementById('notificationFrequency').value = settings.notifications.frequency || 'immediate';
            }

            // LINE settings
            if (settings.line) {
                document.getElementById('defaultReplyMessage').value = settings.line.autoReplyMessage || '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö';
                document.getElementById('autoReply').checked = settings.line.autoReply !== false;
                document.getElementById('richmenu').checked = settings.line.richMenu === true;
                document.getElementById('startTime').value = settings.line.businessHours?.start || '09:00';
                document.getElementById('endTime').value = settings.line.businessHours?.end || '18:00';
            }

            // Security settings
            if (settings.security) {
                document.getElementById('sessionTimeout').value = settings.security.sessionTimeout || 60;
                document.getElementById('maxLoginAttempts').value = settings.security.maxLoginAttempts || 5;
                document.getElementById('twoFactorAuth').checked = settings.security.twoFactorAuth === true;
                document.getElementById('ipWhitelist').checked = settings.security.ipWhitelist === true;
            }
        }

        // Form submissions
        document.getElementById('generalSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await saveSettings('general', {
                systemName: document.getElementById('systemName').value,
                systemDescription: document.getElementById('systemDescription').value,
                timezone: document.getElementById('timezone').value,
                language: document.getElementById('language').value
            });
        });

        document.getElementById('notificationSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await saveSettings('notifications', {
                email: document.getElementById('emailNotifications').checked,
                push: document.getElementById('pushNotifications').checked,
                sms: document.getElementById('smsNotifications').checked,
                frequency: document.getElementById('notificationFrequency').value
            });
        });

        document.getElementById('lineSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await saveSettings('line', {
                autoReplyMessage: document.getElementById('defaultReplyMessage').value,
                autoReply: document.getElementById('autoReply').checked,
                richMenu: document.getElementById('richmenu').checked,
                businessHours: {
                    start: document.getElementById('startTime').value,
                    end: document.getElementById('endTime').value
                }
            });
        });

        document.getElementById('securitySettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await saveSettings('security', {
                sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),
                twoFactorAuth: document.getElementById('twoFactorAuth').checked,
                ipWhitelist: document.getElementById('ipWhitelist').checked
            });
        });

        async function saveSettings(category, data) {
            try {
                // Convert data object to settings array format
                const settings = Object.entries(data).map(([key, value]) => ({
                    key: `${category}.${key}`,
                    value: value,
                    category: category,
                    description: `${category} setting: ${key}`
                }));

                await api.updateSettingsBulk(settings);
                alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤${getCategoryName(category)}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ' + error.message);
            }
        }

        function getCategoryName(category) {
            const names = {
                general: '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
                notifications: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                line: ' LINE',
                security: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢'
            };
            return names[category] || '';
        }

        // Database actions
        document.getElementById('backupBtn').addEventListener('click', () => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)');
            }
        });

        document.getElementById('optimizeBtn').addEventListener('click', () => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)');
            }
        });

        // Quick message management
        document.getElementById('addQuickMessageBtn').addEventListener('click', () => {
            const title = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô:');
            const message = prompt('‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:');
            
            if (title && message) {
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                // Add to list logic here
            }
        });

        // Add styles for quick message items
        const style = document.createElement('style');
        style.textContent = `
            .quick-message-item {
                display: flex;
                align-items: center;
                gap: var(--space-3);
                padding: var(--space-3);
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                margin-bottom: var(--space-3);
                background: var(--bg-secondary);
            }
            
            .quick-message-item:hover {
                background: var(--bg-tertiary);
            }
        `;
        document.head.appendChild(style);
    </script>

    <script src="../js/brand-animation.js"></script>
    <script src="../js/loading.js"></script>
    <script src="../js/keyboard-shortcuts.js"></script>
    <script src="../js/auto-save.js"></script>
    <script src="../js/breadcrumb.js"></script>
    <script src="../js/mobile.js"></script>
    <script src="../js/notifications.js"></script>
    <script src="../js/theme.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/user-display.js"></script>
    <script src="../js/global-user-menu.js"></script>
    <script>
        // Force create user menu and update display after all scripts loaded
        setTimeout(() => {
            if (window.auth && window.auth.isAuthenticated()) {
                console.log('Manually updating user display...');
                if (window.updateUserDisplay) window.updateUserDisplay();
                if (window.forceCreateUserMenu) window.forceCreateUserMenu();
            }
        }, 1000);
    </script>
</body>
</html>